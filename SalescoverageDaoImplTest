package com.ms.datalink.globalDatalink.service;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.Base64;
import java.util.Map;

public class ReceiveRequest {

    public void receiveRequest(Map<String, Object> request) {
        System.out.println("Received request: " + request);

        // 1) Extract fields from the request map
        String fileName      = (String) request.get("fileName");
        Number submissionNum = (Number) request.get("submissionid");
        String targetId      = String.valueOf(request.get("targetld"));
        String base64Content = (String) request.get("fileContent");

        // 2) Decode and write to file
        try {
            byte[] fileBytes = Base64.getDecoder().decode(base64Content);

            // build path: e.g. C:\Users\vikramad\Downloads\client dummy\Outgoing\Timestamp_15844\MSâ€¦.
            Path outputDir = Paths.get(
                "C:", "Users", "vikramad", "Downloads", "client dummy", "Outgoing",
                "Timestamp_" + submissionNum.intValue()
            );
            Files.createDirectories(outputDir);

            Path outputFile = outputDir.resolve(fileName);
            Files.write(outputFile, fileBytes);

            System.out.println("File written to: " + outputFile);

        } catch (IOException e) {
            e.printStackTrace();
            throw new RuntimeException("Failed to write file for submission "
                + submissionNum + ", target " + targetId, e);
        }
    }
}
